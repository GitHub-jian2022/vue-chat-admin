(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b4d597c"],{"57e5":function(e,t,s){"use strict";var o=s("eacb"),i=s.n(o);i.a},"79b0":function(e,t,s){"use strict";s.r(t);var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"room"},[s("van-nav-bar",{staticClass:"header",attrs:{title:"","left-text":e.NavName,"left-arrow":""},on:{"click-left":function(t){return e.$router.back()}},scopedSlots:e._u([{key:"right",fn:function(){return[s("router-link",{attrs:{to:{name:"roomInfo"}}},[s("van-icon",{attrs:{name:"ellipsis",size:"16"}})],1)]},proxy:!0}])}),s("van-pull-refresh",{attrs:{id:"van-pull-refresh","success-text":e.isCompleted?"已加载全部":"刷新成功"},on:{refresh:e.loadHistory},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}},[s("message-list",{attrs:{currentMessageList:e.currentMessageList,userInfo:e.userInfo,toUserInfo:e.currentConversation.userProfile},on:{onAvatarClick:e.onAvatarClick}})],1),s("chat-input",{attrs:{hideMenu:e.hideMenu,hideEmoj:e.hideEmoj,hideMore:e.hideMore},on:{showEmoj:e.showEmoj,showMore:e.showMore,sendText:e.sendText,sendImage:e.sendImage,sendVideo:e.sendVideo,sendFile:e.sendFile}})],1)},i=[],n=s("1ae8"),r=s("d05c"),a=s("2f62"),c={name:"room",components:{MessageList:n["a"],chatInput:r["a"]},data(){return{hideMenu:!0,hideEmoj:!0,hideMore:!0,count:10,userInfo:{},isLoading:!1}},computed:{...Object(a["c"])({currentConversation:e=>e.conversation.currentConversation,currentUnreadCount:e=>e.conversation.currentConversation.unreadCount,currentMessageList:e=>e.conversation.currentMessageList,nextReqMessageID:e=>e.conversation.nextReqMessageID,isCompleted:e=>e.conversation.isCompleted}),...Object(a["b"])("conversation",["toAccount","currentConversationType"]),NavName(){return"C2C"===this.currentConversation.type?this.currentConversation.userProfile.nick||this.toAccount:"GROUP"===this.currentConversation.type?this.currentConversation.groupProfile.name||this.toAccount:"@TIM#SYSTEM"===this.currentConversation.conversationID?"系统通知":this.toAccount}},methods:{getMsgList(){let e=this.currentConversation.conversationID,t=this.tim.getMessageList({conversationID:e,count:this.count});t.then(e=>{this.$store.commit("conversation/pushCurrentMessageList",e.data.messageList),this.$store.commit("conversation/updateNextReqMessageID",e.data.nextReqMessageID),this.$store.commit("conversation/updateIsCompleted",e.data.isCompleted)}),this.$bus.$emit("scroll-bottom")},loadHistory(){this.isLoading=!0;let e=this.currentConversation.conversationID,t=this.tim.getMessageList({conversationID:e,nextReqMessageID:this.nextReqMessageID,count:this.count});t.then(e=>{console.log(e.data),this.$store.commit("conversation/unshiftCurrentMessageList",e.data.messageList),this.$store.commit("conversation/updateNextReqMessageID",e.data.nextReqMessageID),this.$store.commit("conversation/updateIsCompleted",e.data.isCompleted),this.isLoading=!1})},showEmoj(){if(!this.hideMenu&&this.hideEmoj)return this.hideEmoj=!this.hideEmoj,void(this.hideMore=!this.hideMore);this.hideMenu=!this.hideMenu,this.hideEmoj=!this.hideEmoj},showMore(){if(!this.hideMenu&&this.hideMore)return this.hideEmoj=!this.hideEmoj,void(this.hideMore=!this.hideMore);this.hideMenu=!this.hideMenu,this.hideMore=!this.hideMore},hideDrawer(){this.hideMenu=!0,this.hideEmoj=!0,this.hideMore=!0},onAvatarClick(e){console.log("onAvatarClick",e)},sendText(e){if(this.hideDrawer(),!e||0===e.trim().length)return;let t=this.tim.createTextMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{text:e}});this.$store.commit("conversation/pushCurrentMessageList",t),this.tim.sendMessage(t).then(e=>{this.$bus.$emit("scroll-bottom")}).catch(function(e){console.warn("sendMessage error:",e)})},sendImage(){this.hideDrawer();const e=this.tim.createImageMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:document.getElementById("imagePicker")},onProgress:t=>{this.$set(e,"progress",t)}});this.$store.commit("conversation/pushCurrentMessageList",e),this.tim.sendMessage(e).then(()=>{let e=document.getElementById("imagePicker");e.value=null,this.$bus.$emit("scroll-bottom")}).catch(e=>{console.warn("sendMessage error:",e)})},sendVideo(){this.hideDrawer();const e=this.tim.createVideoMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:document.getElementById("videoPicker")},onProgress:t=>{this.$set(e,"progress",t)}});this.$store.commit("conversation/pushCurrentMessageList",e),this.tim.sendMessage(e).then(()=>{let e=document.getElementById("videoPicker");e.value=null,this.$bus.$emit("scroll-bottom")}).catch(e=>{console.warn("sendMessage error:",e)})},sendFile(){this.hideDrawer();const e=this.tim.createFileMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:document.getElementById("filePicker")},onProgress:t=>{this.$set(e,"progress",t)}});this.$store.commit("conversation/pushCurrentMessageList",e),this.tim.sendMessage(e).then(()=>{let e=document.getElementById("filePicker");e.value=null,this.$bus.$emit("scroll-bottom")}).catch(e=>{console.warn("sendMessage error:",e)})},scrollMessageListToButtom(){this.$nextTick(()=>{let e=document.getElementById("message-list");e?e.scrollTop=e.scrollHeight:console.log("messageListNode undefined")})}},mounted(){this.$bus.$on("scroll-bottom",this.scrollMessageListToButtom),this.$bus.$on("hideDrawer",this.hideDrawer),this.userInfo=JSON.parse(localStorage.getItem("userInfo"))||{},console.log("this.userInfo: ",this.userInfo),this.getMsgList()}},h=c,d=(s("57e5"),s("2877")),u=Object(d["a"])(h,o,i,!1,null,"a58754ba",null);t["default"]=u.exports},eacb:function(e,t,s){}}]);
//# sourceMappingURL=chunk-1b4d597c.8db40b88.js.map