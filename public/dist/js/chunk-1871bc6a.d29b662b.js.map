{"version":3,"sources":["webpack:///./src/views/room/index.vue?4995","webpack:///./src/views/room/index.vue?f2d1","webpack:///src/views/room/index.vue","webpack:///./src/views/room/index.vue?0218","webpack:///./src/views/room/index.vue"],"names":["_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_dist_cjs_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_76c5c94c_scoped_true_lang_less___WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_dist_cjs_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_76c5c94c_scoped_true_lang_less___WEBPACK_IMPORTED_MODULE_0___default","n","render","_vm","this","_h","$createElement","_c","_self","staticRenderFns","roomvue_type_script_lang_js_","name","components","MessageList","message_list","chatInput","[object Object]","hideMenu","hideEmoj","hideMore","count","userInfo","isLoading","computed","Object","vuex_esm","currentConversation","state","conversation","currentUnreadCount","unreadCount","currentMessageList","nextReqMessageID","isCompleted","type","userProfile","nick","toAccount","groupProfile","conversationID","watch","val","getMsgList","$router","replace","methods","promise","tim","getMessageList","then","res","$store","commit","data","messageList","$bus","$emit","hideDrawer","console","log","textMsg","trim","length","message","createTextMessage","to","conversationType","currentConversationType","payload","text","sendMessage","catch","imError","warn","createImageMessage","file","document","getElementById","onProgress","percent","$set","imagePickerNode","value","createVideoMessage","videoPickerNode","createFileMessage","filePickerNode","$nextTick","messageListNode","scrollTop","scrollHeight","$on","scrollMessageListToButtom","JSON","parse","localStorage","getItem","views_roomvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__"],"mappings":"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","file":"js/chunk-1871bc6a.d29b662b.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=76c5c94c&scoped=true&lang=less&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=76c5c94c&scoped=true&lang=less&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('router-view')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <router-view></router-view>\r\n</template>\r\n\r\n<script>\r\nimport MessageList from \"@/components/message/message-list.vue\";\r\nimport chatInput from \"@/components/chatInput/index.vue\";\r\nimport { mapState, mapGetters } from \"vuex\";\r\nexport default {\r\n  name: \"room\",\r\n  components: {\r\n    MessageList,\r\n    chatInput\r\n  },\r\n  data() {\r\n    return {\r\n      hideMenu: true,\r\n      hideEmoj: true,\r\n      hideMore: true,\r\n      count: 10,\r\n      userInfo: {},\r\n      isLoading: false\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      currentConversation: state => state.conversation.currentConversation,\r\n      currentUnreadCount: state =>\r\n        state.conversation.currentConversation.unreadCount,\r\n      currentMessageList: state => state.conversation.currentMessageList,\r\n      nextReqMessageID: state => state.conversation.nextReqMessageID,\r\n      isCompleted: state => state.conversation.isCompleted\r\n    }),\r\n    ...mapGetters(\"conversation\", [\"toAccount\", \"currentConversationType\"]),\r\n\r\n    NavName() {\r\n      if (this.currentConversation.type === \"C2C\") {\r\n        return this.currentConversation.userProfile.nick || this.toAccount;\r\n      } else if (this.currentConversation.type === \"GROUP\") {\r\n        return this.currentConversation.groupProfile.name || this.toAccount;\r\n      } else if (this.currentConversation.conversationID === \"@TIM#SYSTEM\") {\r\n        return \"系统通知\";\r\n      }\r\n      return this.toAccount;\r\n    }\r\n  },\r\n  watch: {\r\n    isSDKReady(val) {\r\n      if (val) {\r\n        this.getMsgList();\r\n      }else {\r\n        this.$router.replace('/login')\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    // 加载初始页面消息\r\n    getMsgList() {\r\n      // 历史消息列表\r\n      let conversationID = this.currentConversation.conversationID;\r\n      let promise = this.tim.getMessageList({\r\n        conversationID: conversationID,\r\n        count: this.count\r\n      });\r\n      promise.then(res => {\r\n        this.$store.commit(\r\n          \"conversation/pushCurrentMessageList\",\r\n          res.data.messageList\r\n        );\r\n        this.$store.commit(\r\n          \"conversation/updateNextReqMessageID\",\r\n          res.data.nextReqMessageID\r\n        );\r\n      });\r\n      // 滚动到底部\r\n      this.$bus.$emit(\"scroll-bottom\");\r\n    },\r\n    loadHistory() {\r\n      this.isLoading = true;\r\n      // 更多消息列表\r\n      let conversationID = this.currentConversation.conversationID;\r\n      let promise = this.tim.getMessageList({\r\n        conversationID: conversationID,\r\n        nextReqMessageID: this.nextReqMessageID,\r\n        count: this.count\r\n      });\r\n      promise.then(res => {\r\n        this.$store.commit(\r\n          \"conversation/unshiftCurrentMessageList\",\r\n          res.data.messageList\r\n        );\r\n        // 用于续拉，分页续拉时需传入该字段。\r\n        this.$store.commit(\r\n          \"conversation/updateNextReqMessageID\",\r\n          res.data.nextReqMessageID\r\n        );\r\n        this.isLoading = false;\r\n      });\r\n    },\r\n    showEmoj() {\r\n      if (!this.hideMenu && this.hideEmoj) {\r\n        this.hideEmoj = !this.hideEmoj;\r\n        this.hideMore = !this.hideMore;\r\n        return;\r\n      }\r\n      this.hideMenu = !this.hideMenu;\r\n      this.hideEmoj = !this.hideEmoj;\r\n    },\r\n    showMore() {\r\n      if (!this.hideMenu && this.hideMore) {\r\n        this.hideEmoj = !this.hideEmoj;\r\n        this.hideMore = !this.hideMore;\r\n        return;\r\n      }\r\n      this.hideMenu = !this.hideMenu;\r\n      this.hideMore = !this.hideMore;\r\n    },\r\n    //隐藏抽屉栏\r\n    hideDrawer() {\r\n      this.hideMenu = true;\r\n      this.hideEmoj = true;\r\n      this.hideMore = true;\r\n    },\r\n    msgListClick() {\r\n      this.hideDrawer();\r\n    },\r\n    onAvatarClick(userInfo) {\r\n      console.log(\"onAvatarClick\", userInfo);\r\n    },\r\n    // 发送文字消息\r\n    sendText(textMsg) {\r\n      this.hideDrawer(); //隐藏抽屉\r\n      if (!textMsg || textMsg.trim().length === 0) {\r\n        return;\r\n      }\r\n\r\n      let message = this.tim.createTextMessage({\r\n        to: this.toAccount,\r\n        conversationType: this.currentConversationType,\r\n        payload: {\r\n          text: textMsg\r\n        }\r\n      });\r\n      this.$store.commit(\"conversation/pushCurrentMessageList\", message);\r\n      this.tim\r\n        .sendMessage(message)\r\n        .then(res => {\r\n          this.$bus.$emit(\"scroll-bottom\");\r\n        })\r\n        .catch(function(imError) {\r\n          // 发送失败\r\n          console.warn(\"sendMessage error:\", imError);\r\n        });\r\n    },\r\n    // 发送图片\r\n    sendImage() {\r\n      this.hideDrawer();\r\n      const message = this.tim.createImageMessage({\r\n        to: this.toAccount,\r\n        conversationType: this.currentConversationType,\r\n        payload: {\r\n          file: document.getElementById(\"imagePicker\") // 或者用event.target\r\n        },\r\n        onProgress: percent => {\r\n          this.$set(message, \"progress\", percent); // 手动给message 实例加个响应式属性: progress\r\n        }\r\n      });\r\n      this.$store.commit(\"conversation/pushCurrentMessageList\", message);\r\n      this.tim\r\n        .sendMessage(message)\r\n        .then(() => {\r\n          let imagePickerNode = document.getElementById(\"imagePicker\")\r\n          imagePickerNode.value = null;\r\n          this.$bus.$emit(\"scroll-bottom\");\r\n        })\r\n        .catch(imError => {\r\n          console.warn(\"sendMessage error:\", imError);\r\n        });\r\n    },\r\n    // 发送视频\r\n    sendVideo() {\r\n      this.hideDrawer();\r\n      const message = this.tim.createVideoMessage({\r\n        to: this.toAccount,\r\n        conversationType: this.currentConversationType,\r\n        payload: {\r\n          file: document.getElementById(\"videoPicker\") // 或者用event.target\r\n        },\r\n        onProgress: percent => {\r\n          this.$set(message, \"progress\", percent); // 手动给message 实例加个响应式属性: progress\r\n        }\r\n      });\r\n      this.$store.commit(\"conversation/pushCurrentMessageList\", message);\r\n      this.tim\r\n        .sendMessage(message)\r\n        .then(() => {\r\n          let videoPickerNode = document.getElementById(\"videoPicker\")\r\n          videoPickerNode.value = null;\r\n          this.$bus.$emit(\"scroll-bottom\");\r\n        })\r\n        .catch(imError => {\r\n          console.warn(\"sendMessage error:\", imError);\r\n        });\r\n    },\r\n    //发送文件\r\n    sendFile() {\r\n      this.hideDrawer();\r\n      const message = this.tim.createFileMessage({\r\n        to: this.toAccount,\r\n        conversationType: this.currentConversationType,\r\n        payload: {\r\n          file: document.getElementById(\"filePicker\") // 或者用event.target\r\n        },\r\n        onProgress: percent => {\r\n          this.$set(message, \"progress\", percent); // 手动给message 实例加个响应式属性: progress\r\n        }\r\n      });\r\n      this.$store.commit(\"conversation/pushCurrentMessageList\", message);\r\n      this.tim\r\n        .sendMessage(message)\r\n        .then(() => {\r\n          let filePickerNode = document.getElementById(\"filePicker\")\r\n          filePickerNode.value = null;\r\n          this.$bus.$emit(\"scroll-bottom\");\r\n        })\r\n        .catch(imError => {\r\n          console.warn(\"sendMessage error:\", imError);\r\n        });\r\n    },\r\n    // 直接滚到底部\r\n    scrollMessageListToButtom() {\r\n      this.$nextTick(() => {\r\n        let messageListNode = document.getElementById(\"message-list\");\r\n        if (!messageListNode) {\r\n          console.log(\"messageListNode undefined\");\r\n          return;\r\n        } \r\n        messageListNode.scrollTop = messageListNode.scrollHeight;\r\n      });\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$bus.$on(\"scroll-bottom\", this.scrollMessageListToButtom);\r\n    this.userInfo = JSON.parse(localStorage.getItem(\"userInfo\")) || {};\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped lang='less'>\r\n.room {\r\n  // background: #fff;\r\n  padding-top: 46px;\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  .header {\r\n    position: fixed;\r\n    left: 0;\r\n    top: 0;\r\n    width: 100vw;\r\n    height: 46px;\r\n    background: #fff;\r\n  }\r\n  .van-pull-refresh{\r\n    height: calc(100vh - 90px);\r\n  }\r\n}\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=76c5c94c&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=76c5c94c&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"76c5c94c\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}